name: keep-hf-space-awake

on:
  schedule:
    - cron: "*/30 * * * *"   # every 30 minutes (UTC)
  workflow_dispatch:          # allows manual runs

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    permissions: write-all # allow commits
    steps:
      - uses: actions/checkout@v4

      - name: Update keepalive file
        run: date > keepalive.txt

      - name: Commit keepalive change
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add keepalive.txt
          git commit -m "keepalive: $(date -u)" || echo "No changes"
          git push
          
      - name: Ping Hugging Face Space
        run: |
          # small jitter so many users don't hit at the exact same second
          sleep $((RANDOM % 20))
          # Follow redirects, fail on HTTP >= 400, short timeout
          curl -sSL --fail --max-time 60 \
            -H "User-Agent: keepalive-gh-actions" \
            "https://alexxg20-predictor-cripto.hf.space/?t=$(date +%s)"
